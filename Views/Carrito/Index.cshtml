@model List<CarritoItem>

@{
    var totalGeneral = Model.Sum(i => i.PrecioUnitario * i.Cantidad);
}

<style>
    .cart-item {
        transition: background-color 0.2s ease;
    }
    .cart-item:hover {
        background-color: #f8f9fa;
    }
    .quantity-badge {
        min-width: 40px;
    }
    .total-section {
        background: linear-gradient(135deg, #198754 0%, #146c43 100%);
    }
    .btn-action {
        transition: all 0.2s ease;
    }
    .btn-action:hover {
        transform: scale(1.05);
    }
    .empty-cart {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    }
</style>

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold text-dark">
            <i class="bi bi-cart3 me-2 text-primary"></i>Carrito de Compras
        </h2>
        <a asp-controller="Home" asp-action="Index" class="btn btn-outline-dark">
            <i class="bi bi-arrow-left me-1"></i>Seguir Comprando
        </a>
    </div>

    @if (!Model.Any())
    {
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-body text-center py-5 empty-cart rounded">
                <i class="bi bi-cart-x display-1 text-muted"></i>
                <h4 class="mt-3 fw-semibold">Tu carrito está vacío</h4>
                <p class="text-muted">¡Añade productos para comenzar a comprar!</p>
                <a asp-controller="Home" asp-action="Index" class="btn btn-primary btn-lg mt-2">
                    <i class="bi bi-shop me-1"></i>Ir a comprar
                </a>
            </div>
        </div>
    }
    else
    {
        <div class="row">
            <div class="col-lg-8">
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-dark">
                                    <tr>
                                        <th class="ps-4">Producto</th>
                                        <th class="text-center">Precio</th>
                                        <th class="text-center">Cantidad</th>
                                        <th class="text-end pe-4">Total</th>
                                        <th class="text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model)
                                    {
                                        var totalItem = item.PrecioUnitario * item.Cantidad;
                                        <tr class="cart-item">
                                            <td class="ps-4 py-3">
                                                <div class="fw-semibold">@item.NombreProducto</div>
                                            </td>
                                            <td class="text-center py-3">
                                                <span class="text-muted">$ @item.PrecioUnitario.ToString("N2")</span>
                                            </td>
                                            <td class="text-center py-3">
                                                <span class="badge bg-secondary fs-6 quantity-badge">@item.Cantidad</span>
                                            </td>
                                            <td class="text-end pe-4 py-3">
                                                <span class="fw-bold text-success">$ @totalItem.ToString("N2")</span>
                                            </td>
                                            <td class="text-center py-3">
                                                <div class="btn-group" role="group">
                                                    <a asp-action="Agregar" asp-route-id="@item.ProductoId" class="btn btn-sm btn-success btn-action" title="Aumentar">
                                                        <i class="bi bi-plus-lg"></i>
                                                    </a>
                                                    <a asp-action="Restar" asp-route-id="@item.ProductoId" class="btn btn-sm btn-warning btn-action" title="Disminuir">
                                                        <i class="bi bi-dash-lg"></i>
                                                    </a>
                                                    <a asp-action="Eliminar" asp-route-id="@item.ProductoId" class="btn btn-sm btn-danger btn-action" title="Eliminar">
                                                        <i class="bi bi-trash"></i>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4 mt-3 mt-lg-0">
                <div class="card border-0 shadow-sm total-section text-white">
                    <div class="card-body">
                        <h5 class="card-title fw-semibold mb-4">
                            <i class="bi bi-receipt me-2"></i>Resumen del Pedido
                        </h5>
                        
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-white-50">Subtotal</span>
                            <span>$ @totalGeneral.ToString("N2")</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-white-50">Envío</span>
                            <span>Gratis</span>
                        </div>
                        <hr class="border-light">
                        <div class="d-flex justify-content-between mb-4">
                            <span class="fw-bold">Total</span>
                            <span class="fs-4 fw-bold">$ @totalGeneral.ToString("N2")</span>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <a asp-controller="Carrito" asp-action="Checkout" class="btn btn-light btn-lg fw-semibold">
                                <i class="bi bi-credit-card me-2"></i>Finalizar Compra
                            </a>
                            <a asp-controller="Home" asp-action="Index" class="btn btn-outline-light">
                                <i class="bi bi-arrow-left me-1"></i>Seguir Comprando
                            </a>
                        </div>
                        
                        <div class="mt-3 text-center text-white-50 small">
                            <i class="bi bi-shield-lock me-1"></i>Compra segura
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>
