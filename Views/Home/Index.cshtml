@model IEnumerable<CatalogoWeb.Models.Producto>
@{
    ViewData["Title"] = "Tienda Online";
}

<style>
    .product-card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .product-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 24px rgba(0,0,0,0.15) !important;
    }
    .product-card .btn {
        transition: all 0.2s ease;
    }
    .product-card:hover .btn-primary {
        background-color: #0b5ed7;
        border-color: #0b5ed7;
    }
    .carousel-item {
        height: 400px;
    }
    .carousel-item img {
        height: 100%;
        width: 100%;
        object-fit: contain;
    }
    .flecha-personalizada .carousel-control-prev-icon,
    .flecha-personalizada .carousel-control-next-icon {
        filter: invert(1);
    }
    .search-input:focus {
        border-color: var(--bs-primary);
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }
    .empty-state {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    }
</style>

<div class="container mt-4">
    <div class="text-center mb-5">
        <h1 class="display-5 fw-bold text-dark">
            <i class="bi bi-shop me-2 text-primary"></i>Bienvenido a Nuestra Tienda
        </h1>
        <p class="lead text-muted">Explora nuestro catálogo de productos disponibles</p>
        
        @if (Model != null && Model.Any())
        {
            <div id="productCarousel" class="carousel slide shadow rounded mb-5" data-bs-ride="carousel">
                @{
                    var featuredProducts = Model.Take(5).ToList();
                }
                <div class="carousel-indicators">
                    @for (int i = 0; i < featuredProducts.Count; i++)
                    {
                        <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="@i" class="@(i == 0 ? "active" : "")" aria-current="@(i == 0 ? "true" : "false")"></button>
                    }
                </div>
                <div class="carousel-inner rounded">
                    @for (int i = 0; i < featuredProducts.Count; i++)
                    {
                        <div class="carousel-item @(i == 0 ? "active" : "")" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                            <div class="d-flex justify-content-center align-items-center" style="height: 400px;">
                                <img src="@featuredProducts[i].ImagenUrl" class="d-block" alt="@featuredProducts[i].Nombre" style="max-height: 350px; max-width: 100%; object-fit: contain;">
                            </div>
                            <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-75 rounded p-3">
                                <h4 class="fw-bold">@featuredProducts[i].Nombre</h4>
                                <p class="mb-2">
                                    <span class="badge bg-success fs-6">$ @featuredProducts[i].Precio</span>
                                </p>
                                <a asp-controller="Productos" asp-action="Details" asp-route-id="@featuredProducts[i].Id" class="btn btn-primary btn-sm">
                                    <i class="bi bi-eye me-1"></i>Ver Detalles
                                </a>
                            </div>
                        </div>
                    }
                </div>
                <button class="carousel-control-prev flecha-personalizada" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Anterior</span>
                </button>
                <button class="carousel-control-next flecha-personalizada" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Siguiente</span>
                </button>
            </div>
        }
    </div>
</div>

<div class="container-fluid mb-4">
    <div class="card border-0 shadow-sm">
        <div class="card-body">
            <form asp-controller="Home" asp-action="Index" method="get" class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label class="form-label fw-semibold small text-muted">
                        <i class="bi bi-tag me-1"></i>Categoría
                    </label>
                    <select name="categoriaId" asp-items="ViewBag.Categorias" class="form-select">
                        <option value="">-- Todas --</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label fw-semibold small text-muted">
                        <i class="bi bi-search me-1"></i>Buscar producto
                    </label>
                    <div class="input-group">
                        <span class="input-group-text bg-white border-end-0">
                            <i class="bi bi-search text-muted"></i>
                        </span>
                        <input type="text" name="searchString" class="form-control border-start-0 search-input" placeholder="¿Qué buscas?" value="@Context.Request.Query["searchString"]" />
                    </div>
                </div>
                <div class="col-auto d-flex gap-2">
                    <button type="submit" class="btn btn-dark">
                        <i class="bi bi-funnel me-1"></i>Filtrar
                    </button>
                    @if (!string.IsNullOrEmpty(Context.Request.Query["categoriaId"]) || !string.IsNullOrEmpty(Context.Request.Query["searchString"]))
                    {
                        <a asp-action="Index" class="btn btn-outline-secondary">
                            <i class="bi bi-x-circle me-1"></i>Limpiar
                        </a>
                    }
                </div>
            </form>
        </div>
    </div>
</div>

@if (Model != null && Model.Any())
{
    <div class="container mb-5">
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-4">
            @foreach (var item in Model)
            {
                <div class="col">
                    <div class="card h-100 border-0 shadow-sm product-card">
                        <div class="position-relative">
                            <img src="@item.ImagenUrl" class="card-img-top p-3" alt="@item.Nombre" style="height: 180px; object-fit: contain;">
                            @if (item.Categoria != null)
                            {
                                <span class="position-absolute top-0 start-0 badge bg-secondary m-2">
                                    @item.Categoria.Nombre
                                </span>
                            }
                            @if (item.Stock > 0)
                            {
                                <span class="position-absolute top-0 end-0 badge bg-success m-2">
                                    <i class="bi bi-check-circle me-1"></i>Disponible
                                </span>
                            }
                            else
                            {
                                <span class="position-absolute top-0 end-0 badge bg-danger m-2">
                                    <i class="bi bi-x-circle me-1"></i>Agotado
                                </span>
                            }
                        </div>
                        <div class="card-body d-flex flex-column p-3">
                            <h5 class="card-title h6 fw-semibold text-truncate" title="@item.Nombre">@item.Nombre</h5>
                            <p class="text-muted small text-truncate mb-2">@item.Descripcion</p>
                            <div class="mt-auto">
                                <p class="text-primary fw-bold fs-5 mb-3">$ @item.Precio.ToString("N2")</p>
                                <div class="d-grid gap-2">
                                    @if (item.Stock > 0)
                                    {
                                        <a asp-controller="Carrito" asp-action="Agregar" asp-route-id="@item.Id" class="btn btn-primary">
                                            <i class="bi bi-cart-plus me-1"></i>Agregar al carrito
                                        </a>
                                    }
                                    else
                                    {
                                        <button class="btn btn-secondary" disabled>
                                            <i class="bi bi-cart-x me-1"></i>Agotado
                                        </button>
                                    }
                                    <a asp-controller="Productos" asp-action="Details" asp-route-id="@item.Id" class="btn btn-outline-dark">
                                        <i class="bi bi-eye me-1"></i>Ver Detalles
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
}
else
{
    <div class="container mb-5">
        <div class="text-center py-5 shadow-sm rounded empty-state border">
            <i class="bi bi-search-heart display-1 text-muted"></i>
            <h3 class="mt-3 fw-semibold">No se encontraron productos</h3>
            <p class="text-secondary">Prueba ajustando los filtros o buscando otro término</p>
            @if (!string.IsNullOrEmpty(Context.Request.Query["categoriaId"]) || !string.IsNullOrEmpty(Context.Request.Query["searchString"]))
            {
                <a asp-action="Index" class="btn btn-dark mt-2">
                    <i class="bi bi-arrow-left-circle me-1"></i>Ver todo el catálogo
                </a>
            }
        </div>
    </div>
}
