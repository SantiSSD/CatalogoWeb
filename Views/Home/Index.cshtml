@model IEnumerable<CatalogoWeb.Models.Producto>
@{
	ViewData["Title"] = "Tienda Online";
}
<div class="container mt-4">
	<div class="text-center mb-5">
		<h1 class="display-4 fw-bold">Bienvenido a Nuestra Tienda</h1>
		<p class="lead">Explora nuestro catálogo de productos disponibles.</p>
		<div id="carouselExampleCaptions" class="carousel slide shadow rounded mb-5" data-bs-ride="carousel">
			@{
				var listaProductos = Model.Take(3).ToList();
			}
			<div class="carousel-indicators">

				@for (int i = 0; i < listaProductos.Count; i++)
				{
					<button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="@i" class="@(i == 0 ? "active" : "")" aria-current="@(i == 0 ? "true" : "false")"></button>

				}
			</div>

			<div class="carousel-inner rounded">
				@for (int i = 0; i < listaProductos.Count; i++)
				{
					<div class="carousel-item @(i == 0 ? "active" : "")">
						<div class="d-flex justify-content-center align-items-center bg-light" style="height: 350px;">


							<img src="@listaProductos[i].ImagenUrl"
								 class="d-block h-100 w-auto"
								 alt="@listaProductos[i].Nombre"
								 style="object-fit: contain;">
						</div>

						<div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded px-3">
							<h5>@listaProductos[i].Nombre</h5>
							<p>¡Cómpralo ahora por solo $@listaProductos[i].Precio!</p>
							<a asp-controller="Productos" asp-action="Details" asp-route-id="@listaProductos[i].Id" class="btn btn-sm btn-primary">Ver Producto</a>
						</div>
					</div>

				}
				@* 	<div class="carousel-item">
						<img src="https://via.placeholder.com/1200x400" alt="Oferta 2"  object-fit: contain;">
						<div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded">
							<h5>Nuevos Ingresos</h5>
							<p>Lo último en moda y accesorios ha llegado.</p>
						</div>
					</div> *@
			</div>

			<button class="carousel-control-prev flecha-personalizada"
					type="button"
					data-bs-target="#carouselExampleCaptions"
					data-bs-slide="prev">
				<span class="carousel-control-prev-icon" aria-hidden="true"></span>
				<span class="visually-hidden">Anterior</span>
			</button>

			<button class="carousel-control-next flecha-personalizada"
					type="button"
					data-bs-target="#carouselExampleCaptions"
					data-bs-slide="next">
				<span class="carousel-control-next-icon" aria-hidden="true"></span>
				<span class="visually-hidden">Siguiente</span>
			</button>
		</div>

	</div>
</div>

<div class="container-fluid mb-4">
	<form asp-controller="Home" asp-action="Index" method="get" class="row g-2 align-items-end">

		<div class="col-auto">
			<label class="form-label fw-bold small">Categoría</label>
			<select name="categoriaId" asp-items="ViewBag.Categorias" class="form-select w-auto">
				<option value="">-- Todas --</option>
			</select>
		</div>

		<div class="col-md-4">
			<label class="form-label fw-bold small">Nombre del Producto</label>
			<div class="input-group">
				<span class="input-group-text bg-white border-end-0"><i class="bi bi-search"></i></span>
				<input type="text" name="searchString" class="form-control border-start-0" placeholder="¿Qué buscas?" value="@Context.Request.Query["searchString"]" />
			</div>
		</div>

		<div class="col-auto d-flex gap-2">
			<button type="submit" class="btn btn-dark shadow-sm">
				<i class="bi bi-filter me-1"></i> Filtrar
			</button>

			@if (!string.IsNullOrEmpty(Context.Request.Query["categoriaId"]) || !string.IsNullOrEmpty(Context.Request.Query["searchString"]))
			{
				<a asp-action="Index" class="btn btn-outline-secondary">
					<i class="bi bi-x-circle me-1"></i> Limpiar
				</a>
			}
		</div>

	</form>
</div>

@if (Model != null && Model.Any())
{
	<div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4">

		@foreach (var item in Model)
		{
			<div class="col">
				<div class="card h-100 border-0 shadow-sm transition-hover">
					<img src="@item.ImagenUrl" class="card-img-top p-3" alt="@item.Nombre" style="height: 200px; object-fit: contain;">
					<div class="card-body d-flex flex-column">
						<h5 class="card-title h6">@item.Nombre</h5>
						<p class="text-primary fw-bold fs-5">$ @item.Precio</p>

						<div class="mt-auto d-grid gap-2">
							<a asp-controller="Carrito"
							   asp-action="Agregar"
							   asp-route-id="@item.Id"
							   class="btn btn-primary">
								🛒 Agregar al carrito
							</a>
							<a asp-controller="Productos" asp-action="Details" asp-route-id="@item.Id" class="btn btn-outline-dark w-100">
								Ver Detalles
							</a>
						</div>
					</div>
				</div>
			</div>
		}
	</div>
}

		else
		{
		<div class="text-center py-5 shadow-sm rounded bg-light border">
			<i class="bi bi-search-heart display-1 text-muted"></i>
			<h3 class="mt-3">No se encontraron productos</h3>
			<p class="text-secondary">Prueba ajustando los filtros o buscando otro término.</p>

			@if (!string.IsNullOrEmpty(Context.Request.Query["categoriaId"]) || !string.IsNullOrEmpty(Context.Request.Query["searchString"]))
			{
				<a asp-action="Index" class="btn btn-dark mt-2">
					<i class="bi bi-arrow-left-circle me-1"></i> Ver todo el catálogo
				</a>
			}
		</div>
		}


	<style>
		.transition-hover {
			transition: transform 0.2s;
		}

			.transition-hover:hover {
				transform: translateY(-5px);
			}

		.flecha-personalizada .carousel-control-prev-icon,
		.flecha-personalizada .carousel-control-next-icon {
			filter: invert(1);
		}

		.carousel-item {
			height: 600px;
		}

			.carousel-item img {
				height: 100%;
				width: 100%;
				object-fit: contain;
			}

		.carousel-indicators [data-bs-target].active {
			background-color: blue
		}
	</style>
